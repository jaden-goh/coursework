<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>4-Coin Table Strategy Tester</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --bg: #0b1020;
      --panel: #121a33;
      --panel2: #0f1730;
      --text: #e9ecff;
      --muted: #a8b0df;
      --accent: #7aa2ff;
      --danger: #ff7a7a;
      --good: #7affb5;
      --border: rgba(255,255,255,0.10);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 14px;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(1200px 600px at 20% 10%, #16245a 0%, transparent 55%),
                  radial-gradient(900px 500px at 80% 30%, #2a145a 0%, transparent 55%),
                  var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 18px;
    }

    .app {
      width: min(980px, 100%);
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .app { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 16px;
    }

    h1 {
      font-size: 18px;
      margin: 0 0 8px;
      letter-spacing: 0.2px;
    }
    .subtitle {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      margin-bottom: 12px;
    }

    .boardWrap {
      display: grid;
      gap: 12px;
      align-content: start;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(2, 140px);
      grid-template-rows: repeat(2, 140px);
      gap: 12px;
      justify-content: start;
    }

    .coin {
      border-radius: 18px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
      transition: transform 0.08s ease, border-color 0.12s ease, box-shadow 0.12s ease;
      position: relative;
      overflow: hidden;
    }
    .coin:hover {
      transform: translateY(-2px);
      border-color: rgba(122,162,255,0.45);
      box-shadow: 0 14px 34px rgba(0,0,0,0.35);
    }
    .coin:active { transform: translateY(0px) scale(0.99); }

    .coin .face {
      font-size: 56px;
      font-weight: 800;
      letter-spacing: 1px;
    }
    .coin .label {
      position: absolute;
      bottom: 10px;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      padding: 3px 8px;
      border-radius: 999px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    button {
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      transition: transform 0.08s ease, border-color 0.12s ease, background 0.12s ease;
      font-weight: 650;
      font-size: 13px;
    }
    button:hover { border-color: rgba(122,162,255,0.45); background: rgba(122,162,255,0.10); }
    button:active { transform: scale(0.99); }

    .btnPrimary { border-color: rgba(122,162,255,0.45); background: rgba(122,162,255,0.12); }
    .btnDanger { border-color: rgba(255,122,122,0.45); background: rgba(255,122,122,0.10); }
    .btnGood { border-color: rgba(122,255,181,0.35); background: rgba(122,255,181,0.08); }

    .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
      background: rgba(0,0,0,0.18);
    }
    .pill b { color: var(--text); }

    .history {
      max-height: 430px;
      overflow: auto;
      background: rgba(0,0,0,0.18);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
    }
    .histItem {
      padding: 8px 10px;
      border-bottom: 1px dashed rgba(255,255,255,0.10);
      font-size: 13px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .histItem:last-child { border-bottom: none; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; color: var(--text); }

    .smallNote { color: var(--muted); font-size: 12px; line-height: 1.35; margin-top: 10px; }
    .kbd { font-family: ui-monospace, monospace; padding: 2px 6px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.05); }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>4-Coin Table Strategy Tester</h1>
      <div class="subtitle">
        Click a coin to <b>flip any coin</b>. Use buttons for <b>diagonals</b> and <b>sides</b>.
        Track moves + undo to test strategies.
      </div>

      <div class="boardWrap">
        <div class="row">
          <button class="btnPrimary" id="randomizeBtn">ðŸŽ² Randomize</button>
          <button id="resetBtn">â†© Reset to Start</button>
          <button id="undoBtn">â¤º Undo</button>
          <span class="pill">Moves: <b id="moveCount">0</b></span>
          <span class="pill">State: <b class="mono" id="stateStr">----</b></span>
        </div>

        <div class="board" id="board"></div>

        <div class="row">
          <span class="pill"><b>Diagonal flips</b></span>
          <button id="diagMainBtn">Flip Main Diagonal (TL+BR)</button>
          <button id="diagAntiBtn">Flip Anti Diagonal (TR+BL)</button>
        </div>

        <div class="row">
          <span class="pill"><b>Side flips</b></span>
          <button id="topBtn">Flip Top Side (TL+TR)</button>
          <button id="bottomBtn">Flip Bottom Side (BL+BR)</button>
          <button id="leftBtn">Flip Left Side (TL+BL)</button>
          <button id="rightBtn">Flip Right Side (TR+BR)</button>
        </div>

        <div class="smallNote">
          Tip: The state string is ordered <span class="kbd">TL TR BL BR</span>. Example: <span class="mono">HTTH</span>.
        </div>
      </div>
    </div>

    <div class="card">
      <h1>Move History</h1>
      <div class="subtitle">Use this to see exactly what sequence you tried.</div>

      <div class="history" id="history"></div>

      <div class="row" style="margin-top: 12px;">
        <button class="btnDanger" id="clearHistoryBtn">ðŸ—‘ Clear History</button>
        <button class="btnGood" id="copyStateBtn">ðŸ“‹ Copy Current State</button>
      </div>

      <div class="smallNote">
        Keyboard: <span class="kbd">R</span> randomize, <span class="kbd">Z</span> undo, <span class="kbd">S</span> reset.
      </div>
    </div>
  </div>

<script>
  // Coin order: 0=TL, 1=TR, 2=BL, 3=BR
  // State is boolean: true = Heads (H), false = Tails (T)
  const boardEl = document.getElementById("board");
  const historyEl = document.getElementById("history");
  const moveCountEl = document.getElementById("moveCount");
  const stateStrEl = document.getElementById("stateStr");

  const randomizeBtn = document.getElementById("randomizeBtn");
  const resetBtn = document.getElementById("resetBtn");
  const undoBtn = document.getElementById("undoBtn");
  const clearHistoryBtn = document.getElementById("clearHistoryBtn");
  const copyStateBtn = document.getElementById("copyStateBtn");

  const diagMainBtn = document.getElementById("diagMainBtn");
  const diagAntiBtn = document.getElementById("diagAntiBtn");

  const topBtn = document.getElementById("topBtn");
  const bottomBtn = document.getElementById("bottomBtn");
  const leftBtn = document.getElementById("leftBtn");
  const rightBtn = document.getElementById("rightBtn");

  let state = [true, true, true, true];
  let startState = [...state];

  // For undo: keep stack of previous states
  let undoStack = [];
  // For history: list of {label, before, after}
  let history = [];

  function randBool() { return Math.random() < 0.5; }

  function stateToString(s) {
    return s.map(v => v ? "H" : "T").join("");
  }

  function renderBoard() {
    boardEl.innerHTML = "";
    const labels = ["TL", "TR", "BL", "BR"];

    for (let i = 0; i < 4; i++) {
      const coin = document.createElement("div");
      coin.className = "coin";
      coin.title = "Click to flip this coin";

      const face = document.createElement("div");
      face.className = "face";
      face.textContent = state[i] ? "H" : "T";

      const lab = document.createElement("div");
      lab.className = "label";
      lab.textContent = labels[i];

      coin.appendChild(face);
      coin.appendChild(lab);

      coin.addEventListener("click", () => applyMove(`Flip coin ${labels[i]}`, [i]));
      boardEl.appendChild(coin);
    }

    moveCountEl.textContent = String(history.length);
    stateStrEl.textContent = stateToString(state);
    renderHistory();
  }

  function renderHistory() {
    historyEl.innerHTML = "";
    if (history.length === 0) {
      const empty = document.createElement("div");
      empty.className = "histItem";
      empty.innerHTML = `<span>No moves yet.</span><span class="mono">${stateToString(state)}</span>`;
      historyEl.appendChild(empty);
      return;
    }

    history.forEach((h, idx) => {
      const item = document.createElement("div");
      item.className = "histItem";
      item.innerHTML = `
        <span>${idx + 1}. ${escapeHtml(h.label)} <span class="mono">(${h.before} â†’ ${h.after})</span></span>
        <span class="mono">${h.after}</span>
      `;
      historyEl.appendChild(item);
    });

    // Auto-scroll to bottom
    historyEl.scrollTop = historyEl.scrollHeight;
  }

  function escapeHtml(str) {
    return str.replace(/[&<>"']/g, (m) => ({
      "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
    }[m]));
  }

  function flipIndices(s, indices) {
    const next = [...s];
    for (const i of indices) next[i] = !next[i];
    return next;
  }

  function applyMove(label, indices) {
    const before = stateToString(state);
    undoStack.push([...state]);

    state = flipIndices(state, indices);

    const after = stateToString(state);
    history.push({ label, before, after });

    renderBoard();
  }

  function randomize() {
    undoStack = [];
    history = [];
    state = [randBool(), randBool(), randBool(), randBool()];
    startState = [...state];
    renderBoard();
  }

  function resetToStart() {
    undoStack = [];
    history = [];
    state = [...startState];
    renderBoard();
  }

  function undo() {
    if (undoStack.length === 0) return;
    state = undoStack.pop();
    history.pop();
    renderBoard();
  }

  // Buttons -> moves
  diagMainBtn.addEventListener("click", () => applyMove("Flip main diagonal (TL+BR)", [0, 3]));
  diagAntiBtn.addEventListener("click", () => applyMove("Flip anti diagonal (TR+BL)", [1, 2]));

  topBtn.addEventListener("click", () => applyMove("Flip top side (TL+TR)", [0, 1]));
  bottomBtn.addEventListener("click", () => applyMove("Flip bottom side (BL+BR)", [2, 3]));
  leftBtn.addEventListener("click", () => applyMove("Flip left side (TL+BL)", [0, 2]));
  rightBtn.addEventListener("click", () => applyMove("Flip right side (TR+BR)", [1, 3]));

  randomizeBtn.addEventListener("click", randomize);
  resetBtn.addEventListener("click", resetToStart);
  undoBtn.addEventListener("click", undo);

  clearHistoryBtn.addEventListener("click", () => {
    undoStack = [];
    history = [];
    renderBoard();
  });

  copyStateBtn.addEventListener("click", async () => {
    const txt = stateToString(state);
    try {
      await navigator.clipboard.writeText(txt);
      copyStateBtn.textContent = "âœ… Copied!";
      setTimeout(() => (copyStateBtn.textContent = "ðŸ“‹ Copy Current State"), 900);
    } catch {
      alert("Clipboard blocked by browser. State: " + txt);
    }
  });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "r") randomize();
    if (k === "z") undo();
    if (k === "s") resetToStart();
  });

  // Initial
  randomize();
</script>
</body>
</html>
